function openSigninModal(){return $("#modalLoginForm").modal("show"),!0}function signOut(){localStorage.removeItem("token"),localStorage.removeItem("username"),setTimeout(function(){location.reload()},400)}function convertLocationSearchToJSON(e){var t=e;t='{"'+t.replace("#upload","").replace("#watch","").replace(/\?/gi,"").replace(/\&/gi,'","').replace(/\=/gi,'":"')+'"}';try{t=JSON.parse(t)}catch(e){console.log(e)}return t}function loadPage(e){document.querySelector("#progress-bar").parentNode.style.display="";var t=new XMLHttpRequest;t.onreadystatechange=function(){if(1===this.readyState&&(document.querySelector("#progress-bar").style.width="25%"),2===this.readyState&&(document.querySelector("#progress-bar").style.width="50%"),3===this.readyState&&(document.querySelector("#progress-bar").style.width="75%"),4===this.readyState){var e=this.responseText;$("#v-view").html(e),document.querySelector("#progress-bar").style.width="95%",$(document).ready(function(){setTimeout(function(){document.querySelector("#progress-bar").parentNode.style.display="none",document.querySelector("#progress-bar").style.width="0"},500)})}},t.open("GET",e,!1),t.send()}function loadPageByHash(){var e=document.createElement("script");e.type="text/javascript",e.id="viewScript",""===location.hash?(loadPage("pages/home.htm"),$("#viewScript").remove(),e.src="js/home.min.js",document.body.appendChild(e)):"#playlist"===location.hash?(loadPage("pages/playlist.htm"),$("#viewScript").remove(),e.src="js/playlist.min.js",document.body.appendChild(e)):"#about"===location.hash?(loadPage("pages/about.htm"),$("#viewScript").remove()):null!==location.hash.match(/#upload/gi)?(loadPage("pages/upload.htm"),$("#viewScript").remove(),e.src="js/upload.min.js",document.body.appendChild(e)):null!==location.hash.match(/#watch/gi)?(loadPage("pages/watch.htm"),$("#viewScript").remove(),e.src="js/watch.min.js",document.body.appendChild(e)):"#signup"===location.hash?(loadPage("pages/signup.htm"),$("#viewScript").remove(),e.src="js/signup.min.js",document.body.appendChild(e)):(loadPage("pages/home.htm"),$("#viewScript").remove(),e.src="js/home.min.js",document.body.appendChild(e))}function activeNavbarByHash(){var e=[new RegExp,new RegExp("#upload"),new RegExp("#playlist"),new RegExp("#about"),new RegExp("#signup")],t=document.querySelectorAll(".main-nav-item");if(""===location.hash){t[0].className+=" active";for(var a=1;a<e.length;a++)t[a].className=t[a].className.replace("active","")}else for(t[0].className=t[0].className.replace("active",""),a=1;a<e.length;a++)e[a].test(location.hash)?t[a].className+=" active":t[a].className=t[a].className.replace("active","")}var videoApi="https://youtube-api-challenger2.appspot.com/videos",membersApi="https://youtube-api-challenger2.appspot.com/members",authenticationApi="https://youtube-api-challenger2.appspot.com/authentication",playlistApi="https://youtube-api-challenger2.appspot.com/playlists",userToken=localStorage.getItem("token");toastr.options.positionClass="toast-bottom-right",null!==userToken?(document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[0].innerHTML='<i class="fa fa-user"></i> '+localStorage.getItem("username"),document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[0].removeAttribute("href"),document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[1].innerHTML='<i class="fa fa-sign-out"></i> Đăng xuất',document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[1].addEventListener("click",signOut)):(document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[0].innerHTML='<i class="fa fa-user-plus"></i> Đăng ký',document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[1].innerHTML='<i class="fa fa-sign-in"></i> Đăng nhập',document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[1].addEventListener("click",openSigninModal));var signinData=function(e,t){this.data={type:"MemberLogin",attributes:{username:e,password:t}}};signinData.prototype.signIn=function(){var e=this.data.attributes.username,t=new XMLHttpRequest;t.onreadystatechange=function(){if(200===this.status&&4===this.readyState){var t=JSON.parse(this.responseText);localStorage.setItem("username",e),localStorage.setItem("token",t.data.attributes.secretToken),document.querySelector("#modalLoginForm").classList.remove("fadeIn"),document.querySelector("#modalLoginForm").classList.add("fadeOut"),setTimeout(function(){$("#modalLoginForm").modal("hide"),toastr.success("Đăng nhập thành công!")},100),setTimeout(function(){var e=new RegExp("#signup","gi");console.log(e.test(location.pathname)),console.log(location.pathname),e.test(location.pathname)?location.href="/":location.reload()},1200)}else if(4===this.readyState&&200!==this.status){var a=JSON.parse(this.responseText);toastr.error(a.errors[0].title+"! "+a.errors[0].detail)}},t.open("POST",authenticationApi,!0),t.send(JSON.stringify(this))};var signIn=function(){var e=document.forms.signinForm.username.value,t=document.forms.signinForm.password.value;new signinData(e,t).signIn()},videoData=function(e,t,a,o,n,s){this.data={type:"Video",attributes:{youtubeId:e,name:t,description:a,keywords:o,playlistId:n,thumbnail:s}}};videoData.prototype.pUploadVideo=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState){var t=JSON.parse(this.responseText);201===this.status||200===this.status?e.success(t):e.error(t)}},t.open("POST",videoApi,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send(JSON.stringify(this))};var playlistData=function(e,t,a){this.data={type:"Playlist",attributes:{name:e,description:t,thumbnailUrl:a}}};playlistData.prototype.sendPlaylist=function(){var e=new playlistData;e.data=this.data,this.xhttp=new XMLHttpRequest,this.xhttp.open("POST",playlistApi,!1),this.xhttp.setRequestHeader("Content-Type","application/json"),this.xhttp.setRequestHeader("Authorization",localStorage.getItem("token")),this.xhttp.send(JSON.stringify(e))},loadPageByHash(),activeNavbarByHash(),window.addEventListener("hashchange",function(e){$(".modal").modal("hide"),$(".popover").popover("hide");try{document.body.removeChild(document.querySelector(".modal-backdrop.fade.show"))}catch(e){console.log("No modal to clear!")}loadPageByHash(),activeNavbarByHash()});