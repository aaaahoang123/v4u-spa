function openSigninModal(){return $("#modalLoginForm").modal("show"),!0}function signOut(){localStorage.removeItem("token"),localStorage.removeItem("username"),setTimeout(function(){location.reload()},400)}function convertLocationSearchToJSON(t){var e=t;e='{"'+e.replace("#watch","").replace(/\?/gi,"").replace(/\&/gi,'","').replace(/\=/gi,'":"')+'"}';try{e=JSON.parse(e)}catch(t){console.log(t)}return e}function loadPage(t){$.ajax({url:t,method:"GET",success:function(t){$("#v-view").html(t)},error:function(t){var e=t.responseText;$("#v-view").html(e)}})}function loadPageByHash(){loadPage(""===location.hash?"pages/home.htm":"#playlist"===location.hash?"pages/playlist.htm":"#upload"===location.hash?"pages/upload.htm":null!==location.hash.match(/#watch/gi)?"pages/watch.htm":"#signup"===location.hash?"pages/signup.htm":"pages/home.htm")}var videoApi="https://youtube-api-challenger2.appspot.com/videos",membersApi="https://youtube-api-challenger2.appspot.com/members",authenticationApi="https://youtube-api-challenger2.appspot.com/authentication",playlistApi="https://youtube-api-challenger2.appspot.com/playlists",userToken=localStorage.getItem("token");toastr.options.positionClass="toast-bottom-right",null!==userToken?(document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[0].innerHTML='<i class="fa fa-user"></i> '+localStorage.getItem("username"),document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[0].removeAttribute("href"),document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[1].innerHTML='<i class="fa fa-sign-out"></i> Đăng xuất',document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[1].addEventListener("click",signOut)):(document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[0].innerHTML='<i class="fa fa-user-plus"></i> Đăng ký',document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[1].innerHTML='<i class="fa fa-sign-in"></i> Đăng nhập',document.querySelector("ul.navbar-nav.ml-auto").querySelectorAll("li a")[1].addEventListener("click",openSigninModal));var signinData=function(t,e){this.data={type:"MemberLogin",attributes:{username:t,password:e}}};signinData.prototype.signIn=function(){var t=this.data.attributes.username,e=new XMLHttpRequest;e.onreadystatechange=function(){if(200===this.status&&4===this.readyState){var e=JSON.parse(this.responseText);localStorage.setItem("username",t),localStorage.setItem("token",e.data.attributes.secretToken),document.querySelector("#modalLoginForm").classList.remove("fadeIn"),document.querySelector("#modalLoginForm").classList.add("fadeOut"),setTimeout(function(){$("#modalLoginForm").modal("hide"),toastr.success("Đăng nhập thành công!")},100),setTimeout(function(){null===location.pathname.match(/signup.html/)?location.reload():location.href="../index.html"},1200)}else if(4===this.readyState&&200!==this.status){var a=JSON.parse(this.responseText);toastr.error(a.errors[0].title+"! "+a.errors[0].detail)}},e.open("POST",authenticationApi,!0),e.send(JSON.stringify(this))};var signIn=function(){var t=document.forms.signinForm.username.value,e=document.forms.signinForm.password.value;new signinData(t,e).signIn()},videoData=function(t,e,a,o,n,i){this.data={type:"Video",attributes:{youtubeId:t,name:e,description:a,keywords:o,playlistId:n,thumbnail:i}}};videoData.prototype.pUploadVideo=function(t){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState){var e=JSON.parse(this.responseText);201===this.status||200===this.status?t.success(e):t.error(e)}},e.open("POST",videoApi,!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",localStorage.getItem("token")),e.send(JSON.stringify(this))};var playlistData=function(t,e,a){this.data={type:"Playlist",attributes:{name:t,description:e,thumbnailUrl:a}}};playlistData.prototype.sendPlaylist=function(){var t=new playlistData;t.data=this.data,this.xhttp=new XMLHttpRequest,this.xhttp.open("POST",playlistApi,!1),this.xhttp.setRequestHeader("Content-Type","application/json"),this.xhttp.setRequestHeader("Authorization",localStorage.getItem("token")),this.xhttp.send(JSON.stringify(t))},loadPageByHash(),window.addEventListener("hashchange",function(t){loadPageByHash(),$(".modal").modal("hide"),$(".popover").popover("hide")});