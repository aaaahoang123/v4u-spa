function nextSearchPage(){return getVideo(nextPageToken),!0}function prevSearchPage(){return getVideo(prevPageToken),!0}function getVideo(e){var t="https://content.googleapis.com/youtube/v3/search?q="+document.getElementById("search-query").value+"&videoEmbeddable=true&maxResults=4&type=video&videoSyndicated=true&part=snippet&pageToken="+e+"&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){document.querySelector("nav.row").style.display="",document.querySelector("#videos-thumb").innerHTML="";var e=JSON.parse(this.responseText);nextPageToken=e.nextPageToken,void 0!==e.prevPageToken?(prevPageToken=e.prevPageToken,document.querySelector("#prev-page-btn").classList.remove("disabled")):(prevPageToken="",document.querySelector("#prev-page-btn").classList.add("disabled"));for(var t=0;t<4;t++)new videoData(e.items[t].id.videoId,e.items[t].snippet.title,e.items[t].snippet.description,"","",e.items[t].snippet.thumbnails.medium.url).display()}else console.log(this.responseText)},o.open("GET",t,!0),o.send()}function dragVideo(e,t){e.dataTransfer.setData("text/plain",JSON.stringify(t))}function allowDrop(e){e.preventDefault()}function drop(e){e.preventDefault();var t=JSON.parse(e.dataTransfer.getData("text"));(videoDataToSend=new videoData(t.data.attributes.youtubeId,t.data.attributes.name,t.data.attributes.description,t.data.attributes.keywords,t.data.attributes.playlistId,t.data.attributes.thumbnail)).bindToForm()}function takeInfoOfVideo(){var e="https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+videoDataToSend.data.attributes.youtubeId+"&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e=JSON.parse(this.responseText);if(0!==e.pageInfo.totalResults){if(void 0!==e.items[0].snippet.tags){var t=JSON.stringify(e.items[0].snippet.tags);t=(t=t.replace("[","")).replace("]",""),videoDataToSend.data.attributes.keywords=t}videoDataToSend.data.attributes.description=e.items[0].snippet.description,videoDataToSend.data.attributes.name=e.items[0].snippet.title}else toastr.error("Video này không tồn tại trên hệ thống!")}else e=JSON.parse(this.responseText),toastr.error("Video này không tồn tại trên hệ thống!"),console.log(e)},t.open("GET",e,!0),t.send()}function loadUserPlaylist(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e,t=JSON.parse(this.responseText);if(""!==location.hash.replace("#upload",""))var o=convertLocationSearchToJSON(location.hash);else o=new Object;if(void 0!==o.playlistId)var a=o.playlistId;else a="0";for(var d=0;d<t.data.length;d++)(e=document.createElement("option")).value=t.data[d].id,e.appendChild(document.createTextNode(t.data[d].attributes.name)),t.data[d].id===a&&(document.querySelector("#playlist-select").value=a,e.setAttribute("selected","true")),document.querySelector("#playlist-select select").appendChild(e);$(".material").materialForm()}else t=JSON.parse(this.responseText),console.log(t)},e.open("GET",playlistApi,!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",localStorage.getItem("token")),e.send()}function checkNDemoVideo(){videoDataToSend.data.attributes.youtubeId=document.forms.uploadForm.youtubeId.value,takeInfoOfVideo(),setTimeout(function(){videoDataToSend.demo()},100)}function addVideo(){var e=document.forms.uploadForm.youtubeId,t=document.forms.uploadForm.name,o=document.forms.uploadForm.description.value,a=document.forms.uploadForm.keywords.value,d=document.forms.uploadForm.playlistId.value,i="https://i.ytimg.com/vi/"+e.value+"/mqdefault.jpg",n=new videoData(e.value,t.value,o,a,d,i);e.validity.valid&&t.validity.valid&&(document.querySelectorAll("#add-video-btn i")[0].style.display="none",document.querySelectorAll("#add-video-btn i")[1].style.display="",document.querySelector("#add-video-btn").setAttribute("disabled","true"),n.pUploadVideo({success:function(e){setTimeout(function(){new videoData("","","","","","").bindToForm();for(var e=document.forms.uploadForm.querySelectorAll("label"),t=0;t<e.length;t++)e[t].className="";document.querySelectorAll("#add-video-btn i")[0].style.display="",document.querySelectorAll("#add-video-btn i")[1].style.display="none",document.querySelector("#add-video-btn").removeAttribute("disabled"),toastr.success("Thêm video vào playlist thành công!")},200)},error:function(e){console.log(e)}})),e.validity.tooShort||e.validity.tooLong?toastr.warning("ID của video chỉ có 11 ký tự"):e.validity.patternMismatch?toastr.warning("ID video không được có ký tự đặc biệt"):e.validity.valueMissing&&toastr.warning("ID video không được bỏ trống"),t.validity.tooShort||t.validity.tooLong?toastr.warning("Tên video chỉ có 3 đến 50 ký tự"):t.validity.valueMissing&&toastr.warning("Tên video không được bỏ trống")}function toDemoVideoTab(){document.querySelector("#searchVideoTab").className="animated zoomOut",setTimeout(function(){document.querySelector("#searchVideoTab").style.display="none",document.querySelector("#demoVideoTab").className="animated zoomIn",document.querySelector("#demoVideoTab").style.display=""},200)}function toSearchVideoTab(){document.querySelector("#demoVideoTab").className="animated zoomOut",setTimeout(function(){document.querySelector("#demoVideoTab").style.display="none",document.querySelector("#searchVideoTab").className="animated zoomIn",document.querySelector("#searchVideoTab").style.display="",document.querySelector("#demoVideoTab > div > iframe").src=""},200)}function autoComplete(){videoDataToSend.bindToForm()}function enterToGetVideo(e){13!==e.which&&13!==e.keyCode||getVideo("")}function signInFromAlert(){$("#alert-modal").modal("hide"),$("#modalLoginForm").modal("show")}null===userToken?$("#alert-modal").modal():document.querySelector("main.container").style.display="inherit";var videoDataToSend=new videoData,nextPageToken="",prevPageToken="";videoData.prototype.display=function(){var e=new videoData;e=this;var t=document.createElement("div");t.className="col-lg-6 col-md-12 animated fadeIn";var o=document.createElement("div");o.className="card padding-thumb";var a=document.createElement("a");a.addEventListener("click",function(){e.demo()}),a.addEventListener("click",takeInfoOfVideo),a.addEventListener("dragstart",function(t){dragVideo(t,e)});var d=document.createElement("img");d.src="https://i.ytimg.com/vi/"+this.data.attributes.youtubeId+"/mqdefault.jpg",d.style.width="100%";var i=document.createElement("span");i.appendChild(document.createTextNode(this.data.attributes.name)),a.appendChild(d),o.appendChild(a),t.appendChild(o),t.appendChild(i),document.querySelector("#videos-thumb").appendChild(t)},videoData.prototype.demo=function(){videoDataToSend=this,document.querySelector("#demoVideoTab > div > iframe").src="https://www.youtube.com/embed/"+this.data.attributes.youtubeId+"?autoplay=1",document.querySelector("#demoVideoTab > h5").innerHTML=this.data.attributes.name,document.querySelector("#demoVideoTab > button.btn.btn-info").onclick=autoComplete,toDemoVideoTab()},videoData.prototype.bindToForm=function(){document.forms.uploadForm.youtubeId.value=this.data.attributes.youtubeId;for(var e=document.forms.uploadForm.querySelectorAll("label"),t=0;t<e.length;t++)e[t].className="active";document.forms.uploadForm.name.value=this.data.attributes.name,document.forms.uploadForm.description.value=this.data.attributes.description,document.forms.uploadForm.keywords.value=this.data.attributes.keywords},null!==userToken&&loadUserPlaylist();