function getVideoFromYoutube(e){!0===e&&(pageToken=""),document.querySelector("#see-more-video-btn").setAttribute("disabled","true"),document.querySelectorAll("#see-more-video-btn i")[0].style.display="none",document.querySelectorAll("#see-more-video-btn i")[1].style.display="";var t="https://content.googleapis.com/youtube/v3/search?q="+searchQuery+"&videoEmbeddable=true&maxResults=12&type=video&videoSyndicated=true&part=snippet&pageToken="+pageToken+"&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=(t=JSON.parse(this.responseText)).items;pageToken=t.nextPageToken,setTimeout(function(){for(var t=0;t<e.length;t++)new videoData(e[t].id.videoId,e[t].snippet.title,e[t].snippet.description,"","",e[t].snippet.thumbnails.medium.url).display();toastr.info("Đã load xong video!"),document.querySelectorAll("#see-more-video-btn i")[0].style.display="",document.querySelectorAll("#see-more-video-btn i")[1].style.display="none",document.querySelector("#see-more-video-btn").removeAttribute("disabled")},200)}else if(4===this.readyState&&200!==this.status){var t=JSON.parse(this.responseText);console.log(t)}},a.open("GET",t,!0),a.send()}function searchVideo(){searchQuery=document.querySelector("#search-query").value,document.getElementById("youtubeVideoView").innerHTML="",getVideoFromYoutube(!0)}function enterToSearch(e){13!==e.which&&13!==e.keyCode||searchVideo()}function playVideo(e){document.querySelector("#modalYT div div div div iframe").src="https://www.youtube.com/embed/"+e.youtubeId,document.querySelector("#watch-video-detail").href="#watch?yid="+e.youtubeId,videoDataToSend.data.attributes=e,$("#modalYT").hasClass("show")||setTimeout(function(){$("#modalYT").modal("show")},100)}function closeVideoModal(){$("#modalYT").modal("hide"),setTimeout(function(){document.querySelector("#modalYT div div div div iframe").src="",maximizeModal()},300)}function minimizeModal(){$(window).width()>974?(document.querySelector("#modalYT").className+=" left modal-scrolling",document.querySelector("#modalYT").setAttribute("data-backdrop","false"),document.querySelector("#modalYT > div").className+=" modal-side modal-bottom-left",document.querySelector(".modal-backdrop.fade.show").style.display="none",document.querySelector("#modalYT > div > div.modal-content > div.modal-footer.justify-content-center").style.display="none",document.querySelector("#mini-max-btn").setAttribute("onclick","maximizeModal()"),document.querySelector("#mini-max-btn > span").className="fa fa-window-maximize"):toastr.warning("Chức năng này không hỗ trợ cho màn hình cỡ nhỏ")}function maximizeModal(){document.querySelector("#modalYT").removeAttribute("data-backdrop"),document.querySelector("#modalYT").className=document.querySelector("#modalYT").className.replace(" left modal-scrolling",""),document.querySelector("#modalYT > div").className=document.querySelector("#modalYT > div").className.replace(" modal-side modal-bottom-left",""),document.querySelector("#modalYT > div > div.modal-content > div.modal-footer.justify-content-center").removeAttribute("style"),document.querySelector("#mini-max-btn").setAttribute("onclick","minimizeModal()"),document.querySelector("#mini-max-btn > span").className="fa fa-window-restore",document.querySelector(".modal-backdrop.fade.show").style.display=""}function loadUserPlaylist(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.response).data,t=document.querySelector("#playlist-tab"),a=document.querySelector("section#modalYT > div > div > div > div.dropdown > div.dropdown-menu");if(void 0!==e){for(var d=e.length-1;d>=0&&d>=e.length-3;d--)bindPlaylistToSide(e[d],t),0!==d&&d!==e.length-3&&t.appendChild(document.createElement("hr"));for(d=0;d<e.length;d++)bindPlaylistToModal(e[d],a)}else $('#sticky-playlist-tabs > div > ul > li > a[href="#add-playlist-tab"]').tab("show")}else 4===this.readyState&&200!==this.status&&console.log(this.response)},e.open("GET",playlistApi),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",localStorage.getItem("token")),e.send()}function bindPlaylistToSide(e,t){var a=e.id,d=document.createElement("div");d.className="row padding-thumb animated fadeIn",d.addEventListener("dragover",function(e){allowDrop(e)}),d.setAttribute("ondrop","drop(event,"+a+")");var o=document.createElement("a");o.href="#watch?plid="+a,o.className="col-md-4 col-sm-6 responsive-background",o.style.backgroundImage="url("+e.attributes.thumbnailUrl+")";var i=document.createElement("div");i.className="col-md-8 col-sm-6",i.style.paddingTop="5px";var n=document.createElement("a");n.className="grey-text",n.href="#watch?plid="+a;var l=document.createElement("h5");l.appendChild(document.createTextNode(e.attributes.name)),n.appendChild(l);var r=document.createElement("p");r.appendChild(document.createTextNode(e.attributes.description)),i.appendChild(n),i.appendChild(r),d.appendChild(o),d.appendChild(i),t.appendChild(d)}function bindPlaylistToModal(e,t){var a=document.createElement("a");a.className="dropdown-item",a.appendChild(document.createTextNode(e.attributes.name)),a.onclick=function(){addVideoToPlaylist(e.id)},t.appendChild(a)}function addPlaylist(){var e=document.querySelector("#playlist-name"),t=document.querySelector("#playlist-description"),a=document.querySelector("#playlist-thumbnail");if(e.validity.valueMissing)toastr.warning("Tên playlist không được để trống");else if(e.validity.tooShort)toastr.warning("Tên playlist có ít nhất 7 ký tự");else{var d=new playlistData(e.value,t.value,a.value);if(d.sendPlaylist(),document.querySelectorAll("#add-playlist-btn i")[0].style.display="none",document.querySelectorAll("#add-playlist-btn i")[1].style.display="",document.querySelector("#add-playlist-btn").setAttribute("disabled","true"),201===d.xhttp.status){var o=JSON.parse(d.xhttp.responseText).data;setTimeout(function(){document.querySelector("#playlist-tab").appendChild(document.createElement("hr")),bindPlaylistToSide(o,document.querySelector("#playlist-tab")),bindPlaylistToModal(o,document.querySelector("section#modalYT > div > div > div > div.dropdown > div.dropdown-menu")),$(function(){$('#sticky-playlist-tabs > div > ul > li > a[href="#playlist-tab"]').tab("show")}),document.querySelector("#playlist-name").value="",document.querySelector("#playlist-description").value="",document.querySelector("#playlist-thumbnail").value="",document.querySelectorAll("#add-playlist-btn i")[0].style.display="",document.querySelectorAll("#add-playlist-btn i")[1].style.display="none",document.querySelector("#add-playlist-btn").removeAttribute("disabled"),toastr.success("Thêm playlist thành công")},300)}else o=JSON.parse(d.xhttp.responseText),console.log(o),toastr.error("Đã xảy ra lỗi. Vui lòng inspect logs và báo cho chúng tôi")}}function addVideoToPlaylist(e){videoDataToSend.quickUploadVideo(e)}function loadTopTrendingVideo(){xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){if(4===this.readyState)if(200===this.status)for(var e=JSON.parse(this.responseText),t=e.items,a=document.querySelector("#carousel-top-trend div").querySelectorAll("div.carousel-item a div.view"),d=document.querySelector("#carousel-top-trend div").querySelectorAll("div.carousel-item a div img"),o=document.querySelector("#carousel-top-trend div").querySelectorAll("div.carousel-item a div h4"),i=document.querySelector("#carousel-top-trend div").querySelectorAll("div.carousel-item a"),n=0;n<t.length;n++)void 0!==t[n].snippet.thumbnails.maxres?(d[n].src=t[n].snippet.thumbnails.maxres.url,a[n].classList.remove("thumb")):void 0!==t[n].snippet.thumbnails.standard?d[n].src=t[n].snippet.thumbnails.standard.url:d[n].src=t[n].snippet.thumbnails.high.url,d[n].alt=t[n].snippet.title,o[n].innerHTML=t[n].snippet.title,i[n].href="#watch?yid="+t[n].id,i[n].title=t[n].snippet.title;else e=JSON.parse(this.responseText),console.log(e)},xhttp.open("GET","https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&maxResults=3&regionCode=VN&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",!0),xhttp.send()}function getNewAddVideo(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e=JSON.parse(this.responseText);void 0!==e.data?(document.querySelector("#new-video-card > div > div > a").href="#watch?plid="+e.data[0].attributes.playlistId+"&cid="+e.data[0].id,document.querySelector("#new-video-card > div > div > a > div > img").src="https://i.ytimg.com/vi/"+e.data[0].attributes.youtubeId+"/mqdefault.jpg",document.querySelector("#new-video-card > div > div > a > div > img").alt=e.data[0].attributes.name,document.querySelector("#new-video-card > div > div > a > div > p").innerHTML=e.data[0].attributes.name):(document.querySelector("#new-video-card > div > div > a > div > img").src="http://1.bp.blogspot.com/-SRdKauDRBg4/T3pVgdOxgAI/AAAAAAAAAZs/-QxJ9qdb8FI/s640/undefined_01.jpg",document.querySelector("#new-video-card > div > div > a > div > img").alt="Chưa có video",document.querySelector("#new-video-card > div > div > a > div > p").innerHTML="Không có video mới! Bạn chưa đăng nhập hoặc chưa từng upload video")}else e=JSON.parse(this.responseText),console.log(e)},e.open("GET",videoApi+"?page=1&limit=1",!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",localStorage.getItem("token")),e.send()}function dragVideo(e,t){e.dataTransfer.setData("text/plain",JSON.stringify(t))}function allowDrop(e){e.preventDefault()}function drop(e,t){e.preventDefault();var a=e.dataTransfer.getData("text");videoDataToSend.data.attributes=JSON.parse(a),videoDataToSend.quickUploadVideo(t)}var pageToken="",searchQuery="",videoDataToSend=new videoData;videoData.prototype.display=function(){var e=this.data.attributes,t=document.createElement("div");t.className="col-lg-4 col-md-6 col-sm-6 animated fadeIn",t.style.overflow="hidden",t.style.textOverflow="ellipsis";var a=document.createElement("div");a.className="card",a.addEventListener("dragstart",function(t){dragVideo(t,e)}),a.draggable="true";var d=document.createElement("div");d.className="view overlay waves-effect waves-light z-depth-1";var o=document.createElement("img");o.className="img-fluid",o.src=this.data.attributes.thumbnail,o.style.width="100%",o.alt=this.data.attributes.name;var i=document.createElement("a");i.addEventListener("click",function(){playVideo(e)});var n=document.createElement("div");n.className="mask flex-center";var l=document.createElement("i");l.className="fa fa-play-circle-o fa-3x white-text",n.appendChild(l),i.appendChild(n),d.appendChild(o),d.appendChild(i),a.appendChild(d);var r=document.createElement("a");r.className="grey-text",r.addEventListener("click",function(){playVideo(e)});var s=document.createElement("h6");s.appendChild(document.createTextNode(this.data.attributes.name)),r.appendChild(s),t.appendChild(a),t.appendChild(r),document.getElementById("youtubeVideoView").appendChild(t)},videoData.prototype.quickUploadVideo=function(e){this.data.attributes.playlistId=e,this.pUploadVideo({success:function(e){toastr.success("Thêm video vào playlist thành công!")},error:function(e){toastr.warning("Đã xảy ra lỗi, vui lòng inspect logs và báo cho chúng tôi"),console.log(e)}})},$(document).ready(function(){getVideoFromYoutube(),loadTopTrendingVideo(),null!==userToken?(loadUserPlaylist(),document.getElementById("sticky-playlist-tabs").style.display="inherit",document.querySelector("section#modalYT > div > div > div > div.dropdown").style.display="",getNewAddVideo()):(document.querySelector("#new-video-card > div > div > a > div > img").src="http://1.bp.blogspot.com/-SRdKauDRBg4/T3pVgdOxgAI/AAAAAAAAAZs/-QxJ9qdb8FI/s640/undefined_01.jpg",document.querySelector("#new-video-card > div > div > a > div > img").alt="Chưa có video",document.querySelector("#new-video-card > div > div > a > div > p").innerHTML="Không có video mới! Bạn chưa đăng nhập hoặc chưa từng upload video")});