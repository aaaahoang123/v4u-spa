function loadNBindPlaylist(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText).data;if(void 0!==e){playlistArray=e;for(var t=0;t<e.length;t++)bindPlaylist(e[t])}}},e.open("GET",playlistApi,!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",localStorage.getItem("token")),e.send()}function bindPlaylist(e){var t=document.createElement("div");t.className="col-lg-4 col-md-6 col-sm-6 padding-thumb",t.id=e.id;var a=document.createElement("div");a.className="card";var l=document.createElement("div");l.className="view overlay hm-white-slight";var i=document.createElement("div");i.className="playlist-thumb",i.style.backgroundImage="url("+e.attributes.thumbnailUrl+")";var n=document.createElement("a");n.addEventListener("click",function(){loadVideoByPlaylistId(e.id)}),n.addEventListener("click",function(){showVideoInPlTab(e.attributes.name,e.id)});var d=document.createElement("div");d.className="mask waves-effect waves-light",n.appendChild(d),l.appendChild(i),l.appendChild(n),a.appendChild(l);var o=document.createElement("a");o.className="btn-floating btn-action waves-effect waves-light",o.addEventListener("click",function(){loadVideoByPlaylistId(e.id)}),o.addEventListener("click",function(){showVideoInPlTab(e.attributes.name,e.id)});var r=document.createElement("i");r.className="fa fa-chevron-right",o.appendChild(r),a.appendChild(o);var s=document.createElement("div");s.className="card-body";var c=document.createElement("h4");c.className="card-title limit-char-p",c.appendChild(document.createTextNode(e.attributes.name)),s.appendChild(c),s.appendChild(document.createElement("hr"));var m=document.createElement("p");m.className="card-text limit-char-p",m.appendChild(document.createTextNode(e.attributes.description)),s.appendChild(m),a.appendChild(s);var p=document.createElement("div");p.className="card-data";var u=document.createElement("ul"),h=document.createElement("li"),v=document.createElement("i");v.className="fa fa-clock-o",h.appendChild(v),h.appendChild(document.createTextNode(" "+new Date(e.attributes.createdTimeMLS).toLocaleDateString())),u.appendChild(h);var y=document.createElement("li"),f=document.createElement("a");f.href="#upload?playlistId="+e.id;var g=document.createElement("i");g.className="fa fa-plus",f.appendChild(g),f.appendChild(document.createTextNode("Thêm")),y.appendChild(f);var b=document.createElement("li"),E=document.createElement("a");E.onclick=function(){document.querySelector("#form19").value=e.attributes.name,document.querySelector("#form8").value=e.attributes.description,document.querySelector("#form21").value=e.attributes.thumbnailUrl;for(var t=document.querySelector("#edit-playlist-modal").querySelectorAll("label"),a=0;a<t.length;a++)t[a].className="active";playlistToEditId=e.id,$("#edit-playlist-modal").modal()};var C=document.createElement("i");C.className="fa fa-edit",E.appendChild(C),E.appendChild(document.createTextNode("Sửa")),b.appendChild(E);var S=document.createElement("li"),T=document.createElement("a");T.addEventListener("click",function(){confirmDeletePl(e.id,e.attributes.name)});var N=document.createElement("i");N.className="fa fa-trash",T.appendChild(N),T.appendChild(document.createTextNode("Xóa")),S.appendChild(T),u.appendChild(y),u.appendChild(b),u.appendChild(S),p.appendChild(u),a.appendChild(p),t.appendChild(a),document.querySelector("#playlist-tab div.row.display-flex").appendChild(t)}function loadVideoByPlaylistId(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e=JSON.parse(this.responseText).data;if(void 0!==e){document.querySelector("#video-inPl-tab div.row.display-flex").innerHTML="";for(var t=0;t<e.length;t++)new videoData("",e[t].attributes.name,"","","",e[t].attributes.thumbnail).display(e[t].id,e[t].attributes.playlistId)}else document.querySelector("#video-inPl-tab div.row.display-flex").innerHTML=""}else e=JSON.parse(this.responseText),console.log(e)},t.open("GET",videoApi+"?playlist="+e+"&page=1&limit=100",!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function showVideoInPlTab(e,t){document.querySelector("#localTab").querySelectorAll("li")[2].style.display="",document.querySelector("#video-inPl-tab > ul > li > a > span").innerHTML=e,document.querySelector("#video-inPl-tab > ul").querySelectorAll("li a")[1].href="#upload?playlistId="+t,setTimeout(function(){$(function(){$("#localTab a:last").tab("show")})},300)}function addPlaylist(){var e=document.forms["add-playlist-form"].name,t=document.forms["add-playlist-form"].description,a=document.forms["add-playlist-form"].thumbnail;if(e.validity.valueMissing)toastr.warning("Tên playlist không được để trống");else if(e.validity.tooShort)toastr.warning("Tên playlist có ít nhất 7 ký tự");else{var l=new playlistData(e.value,t.value,a.value);if(l.sendPlaylist(),201===l.xhttp.status){var i=JSON.parse(l.xhttp.responseText).data;bindPlaylist(i),toastr.success("Thêm playlist thành công"),$(function(){$("#localTab a:first").tab("show")}),document.forms["add-playlist-form"].name.value="",document.forms["add-playlist-form"].description.value="",document.forms["add-playlist-form"].thumbnail.value=""}else i=JSON.parse(l.xhttp.responseText),console.log(i),toastr.error("Đã xảy ra lỗi. Vui lòng inspect logs và báo cho chúng tôi")}}function deletePlaylist(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){toastr.error("Xóa playlist thành công"),$("#delete-playlist-modal").modal("hide"),document.querySelector("#playlist-tab div.row.display-flex").removeChild(document.getElementById(e));var t=JSON.parse(this.responseText)}else t=JSON.parse(this.responseText),console.log(t)},t.open("DELETE",playlistApi+"/"+e),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function confirmDeletePl(e,t){$("#delete-playlist-modal").modal("show"),document.querySelector("#delete-playlist-modal > div > div > div > div > p").innerHTML="Bạn thực sự muốn xóa playlist <strong class='red-text'>"+t+"</strong>?",document.querySelector("#delete-playlist-modal > div > div > div.modal-footer a.btn-primary-modal").onclick=function(){deletePlaylist(e)}}function signInFromAlert(){$("#alert-modal").modal("hide"),$("#modalLoginForm").modal("show")}function deleteVideo(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status)toastr.error("Xóa video thành công"),document.querySelector("#video-inPl-tab div.row.display-flex").removeChild(document.getElementById(e)),$("#delete-playlist-modal").modal("hide");else{var t=JSON.parse(this.responseText);toastr.error("Đã xảy ra lỗi! Xóa video thất bại"),console.log(t)}},t.open("DELETE",videoApi+"/"+e,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function confirmDeleteVideo(e,t){$("#delete-playlist-modal").modal("show"),document.querySelector("#delete-playlist-modal > div > div > div > div > p").innerHTML="Bạn thực sự muốn xóa video <strong class='red-text'>"+t+"</strong>?",document.querySelector("#delete-playlist-modal > div > div > div.modal-footer a.btn-primary-modal").onclick=function(){deleteVideo(e)}}function editPlaylist(){var e=document.querySelector("#form19").value,t=document.querySelector("#form8").value,a=document.querySelector("#form21").value,l=new playlistData(e,t,a),i=new XMLHttpRequest;i.onreadystatechange=function(){if(console.log(this),4===this.readyState)if(200===this.status||201===this.status)toastr.success("Chỉnh sửa playlist thành công");else{var e=JSON.parse(this.response);console.log(e),toastr.error("Xảy ra lỗi khi chỉnh sửa, vui lòng inspect logs và báo cho chúng tôi")}},i.open("PUT",playlistApi+"?id="+playlistToEditId,"true"),xhttp.setRequestHeader("Content-Type","application/json"),xhttp.setRequestHeader("Authorization",localStorage.getItem("token")),i.send(JSON.stringify(l))}null===userToken?$("#alert-modal").modal():document.querySelector("main.container").style.display="";var playlistToEditId="",playlistArray=new Array;videoData.prototype.display=function(e,t){var a=this.data.attributes.name,l=document.createElement("div");l.id=e,l.className="col-lg-3 col-md-4 col-sm-6 animated fadeIn",l.style.overflow="hidden",l.style.textOverflow="ellipsis";var i=document.createElement("div");i.className="card padding-thumb";var n=document.createElement("div");n.className="view overlay waves-effect waves-light hm-white-strong";var d=document.createElement("img");d.className="img-fluid",d.src=this.data.attributes.thumbnail,d.style.width="100%",d.alt=this.data.attributes.name;var o=document.createElement("div");o.className="mask flex-center";var r=document.createElement("a");r.className="black-text",r.href="#watch?cid="+e+"&plid="+t,r.style.margin="0 5px";var s=document.createElement("i");s.className="fa fa-play fa-2x",r.appendChild(s);var c=document.createElement("a");c.style.margin="0 5px";var m=document.createElement("i");m.className="fa fa-trash fa-2x",c.appendChild(m),c.addEventListener("click",function(){confirmDeleteVideo(e,a)}),o.appendChild(r),o.appendChild(document.createTextNode("|")),o.appendChild(c),n.appendChild(d),n.appendChild(o),i.appendChild(n);var p=document.createElement("a");p.className="grey-text";var u=document.createElement("h6");u.appendChild(document.createTextNode(this.data.attributes.name)),p.appendChild(u),l.appendChild(i),l.appendChild(p),document.querySelector("#video-inPl-tab div.row.display-flex").appendChild(l)},document.getElementById("edit-btn").onclick=editPlaylist,loadNBindPlaylist();