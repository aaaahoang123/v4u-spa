function loadNBindPlaylist(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.responseText).data;if(void 0!==e){playlistArray=e;for(var t=0;t<e.length;t++)bindPlaylist(e[t])}}},e.open("GET",playlistApi,!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",localStorage.getItem("token")),e.send()}function bindPlaylist(e){var t=document.createElement("div");t.className="col-lg-4 col-md-6 col-sm-6 padding-thumb",t.id=e.id;var a=document.createElement("div");a.className="card";var l=document.createElement("div");l.className="view overlay hm-white-slight";var d=document.createElement("div");d.className="playlist-thumb",d.style.backgroundImage="url("+e.attributes.thumbnailUrl+")";var i=document.createElement("a");i.addEventListener("click",function(){loadVideoByPlaylistId(e.id)}),i.addEventListener("click",function(){showVideoInPlTab(e.attributes.name,e.id)});var n=document.createElement("div");n.className="mask waves-effect waves-light",i.appendChild(n),l.appendChild(d),l.appendChild(i),a.appendChild(l);var o=document.createElement("a");o.className="btn-floating btn-action waves-effect waves-light",o.addEventListener("click",function(){loadVideoByPlaylistId(e.id)}),o.addEventListener("click",function(){showVideoInPlTab(e.attributes.name,e.id)});var r=document.createElement("i");r.className="fa fa-chevron-right",o.appendChild(r),a.appendChild(o);var s=document.createElement("div");s.className="card-body";var c=document.createElement("h4");c.className="card-title limit-char-p",c.appendChild(document.createTextNode(e.attributes.name)),s.appendChild(c),s.appendChild(document.createElement("hr"));var m=document.createElement("p");m.className="card-text limit-char-p",m.appendChild(document.createTextNode(e.attributes.description)),s.appendChild(m),a.appendChild(s);var p=document.createElement("div");p.className="card-data";var u=document.createElement("ul"),h=document.createElement("li"),v=document.createElement("i");v.className="fa fa-clock-o",h.appendChild(v),h.appendChild(document.createTextNode(new Date(e.attributes.createdTimeMLS).toLocaleDateString())),u.appendChild(h);var y=document.createElement("li"),f=document.createElement("a");f.href="#upload?playlistId="+e.id;var b=document.createElement("i");b.className="fa fa-upload",f.appendChild(b),f.appendChild(document.createTextNode("Upload")),y.appendChild(f);var g=document.createElement("li"),E=document.createElement("a");E.addEventListener("click",function(){confirmDeletePl(e.id,e.attributes.name)});var C=document.createElement("i");C.className="fa fa-trash",E.appendChild(C),E.appendChild(document.createTextNode("Xóa")),g.appendChild(E),u.appendChild(y),u.appendChild(g),p.appendChild(u),a.appendChild(p),t.appendChild(a),document.querySelector("#playlist-tab div.row.display-flex").appendChild(t)}function loadVideoByPlaylistId(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e=JSON.parse(this.responseText).data;if(void 0!==e){document.querySelector("#video-inPl-tab div.row.display-flex").innerHTML="";for(var t=0;t<e.length;t++)new videoData("",e[t].attributes.name,"","","",e[t].attributes.thumbnail).display(e[t].id,e[t].attributes.playlistId)}else document.querySelector("#video-inPl-tab div.row.display-flex").innerHTML=""}else e=JSON.parse(this.responseText),console.log(e)},t.open("GET",videoApi+"?playlist="+e+"&page=1&limit=100",!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function showVideoInPlTab(e,t){document.querySelector("#localTab").querySelectorAll("li")[2].style.display="",document.querySelector("#video-inPl-tab > ul > li > a > span").innerHTML=e,document.querySelector("#video-inPl-tab > ul").querySelectorAll("li a")[1].href="#upload?playlistId="+t,setTimeout(function(){$(function(){$("#localTab a:last").tab("show")})},300)}function addPlaylist(){var e=document.forms["add-playlist-form"].name,t=document.forms["add-playlist-form"].description,a=document.forms["add-playlist-form"].thumbnail;if(e.validity.valueMissing)toastr.warning("Tên playlist không được để trống");else if(e.validity.tooShort)toastr.warning("Tên playlist có ít nhất 7 ký tự");else{var l=new playlistData(e.value,t.value,a.value);if(l.sendPlaylist(),201===l.xhttp.status){var d=JSON.parse(l.xhttp.responseText).data;bindPlaylist(d),toastr.success("Thêm playlist thành công"),$(function(){$("#localTab a:first").tab("show")}),document.forms["add-playlist-form"].name.value="",document.forms["add-playlist-form"].description.value="",document.forms["add-playlist-form"].thumbnail.value=""}else d=JSON.parse(l.xhttp.responseText),console.log(d),toastr.error("Đã xảy ra lỗi. Vui lòng inspect logs và báo cho chúng tôi")}}function deletePlaylist(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){toastr.error("Xóa playlist thành công"),$("#delete-playlist-modal").modal("hide"),document.querySelector("#playlist-tab div.row.display-flex").removeChild(document.getElementById(e));var t=JSON.parse(this.responseText)}else t=JSON.parse(this.responseText),console.log(t)},t.open("DELETE",playlistApi+"/"+e),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function confirmDeletePl(e,t){$("#delete-playlist-modal").modal("show"),document.querySelector("#delete-playlist-modal > div > div > div.modal-header > h5").innerHTML="Bạn thực sự muốn xóa playlist "+t+"?",document.querySelector("#delete-playlist-modal > div > div > div.modal-body button.btn.danger-color").removeAttribute("onclick"),document.querySelector("#delete-playlist-modal > div > div > div.modal-body button.btn.danger-color").setAttribute("onclick",'deletePlaylist("'+e+'")')}function signInFromAlert(){$("#alert-modal").modal("hide"),$("#modalLoginForm").modal("show")}function deleteVideo(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status)toastr.error("Xóa video thành công"),document.querySelector("#video-inPl-tab div.row.display-flex").removeChild(document.getElementById(e)),$("#delete-playlist-modal").modal("hide");else{var t=JSON.parse(this.responseText);toastr.error("Đã xảy ra lỗi! Xóa video thất bại"),console.log(t)}},t.open("DELETE",videoApi+"/"+e,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function confirmDeleteVideo(e,t){$("#delete-playlist-modal").modal("show"),document.querySelector("#delete-playlist-modal > div > div > div.modal-header > h5").innerHTML="Bạn thực sự muốn xóa video "+t+"?",document.querySelector("#delete-playlist-modal > div > div > div.modal-body button.btn.danger-color").removeAttribute("onclick"),document.querySelector("#delete-playlist-modal > div > div > div.modal-body button.btn.danger-color").setAttribute("onclick",'deleteVideo("'+e+'")')}null===userToken?$("#alert-modal").modal():document.querySelector("main.container").style.display="";var playlistArray=new Array;videoData.prototype.display=function(e,t){var a=this.data.attributes.name,l=document.createElement("div");l.id=e,l.className="col-lg-3 col-md-4 col-sm-6 animated fadeIn",l.style.overflow="hidden",l.style.textOverflow="ellipsis";var d=document.createElement("div");d.className="card padding-thumb";var i=document.createElement("div");i.className="view overlay waves-effect waves-light hm-white-strong";var n=document.createElement("img");n.className="img-fluid",n.src=this.data.attributes.thumbnail,n.style.width="100%",n.alt=this.data.attributes.name;var o=document.createElement("div");o.className="mask flex-center";var r=document.createElement("a");r.className="black-text",r.href="#watch?cid="+e+"&plid="+t,r.style.margin="0 5px";var s=document.createElement("i");s.className="fa fa-play fa-2x",r.appendChild(s);var c=document.createElement("a");c.style.margin="0 5px";var m=document.createElement("i");m.className="fa fa-trash fa-2x",c.appendChild(m),c.addEventListener("click",function(){confirmDeleteVideo(e,a)}),o.appendChild(r),o.appendChild(document.createTextNode("|")),o.appendChild(c),i.appendChild(n),i.appendChild(o),d.appendChild(i);var p=document.createElement("a");p.className="grey-text";var u=document.createElement("h6");u.appendChild(document.createTextNode(this.data.attributes.name)),p.appendChild(u),l.appendChild(d),l.appendChild(p),document.querySelector("#video-inPl-tab div.row.display-flex").appendChild(l)};loadNBindPlaylist();