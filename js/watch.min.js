function loadSuggestVideo(e){var t="https://content.googleapis.com/youtube/v3/search?q="+e+"&videoEmbeddable=true&maxResults=10&type=video&videoSyndicated=true&part=snippet&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var e=JSON.parse(this.responseText).items,t=0;t<e.length;t++){var a=new videoData(e[t].id.videoId,e[t].snippet.title,e[t].snippet.description,"","",e[t].snippet.thumbnails.medium.url);a.addIdCrTime("",e[t].snippet.publishedAt),a.bindToSide()}$(".hover-popover").popover({trigger:"hover"})}else respone=JSON.parse(this.responseText),console.log(respone),toastr.warning("Đã xảy ra lỗi! Có thể không tìm thấy video nào liên quan!")},a.open("GET",t,!0),a.send()}function loadVideoOfYoutube(e,t){var a="https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+e+"&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e=JSON.parse(this.responseText).items[0];t.success(e)}else e=JSON.parse(this.responseText),toastr.error("Xảy ra lỗi khi load video, vui lòng kiểm inspect log và báo cho chúng tôi"),console.log(e)},i.open("GET",a,!0),i.send()}function loadVideoOfPlaylist(e,t){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var a=JSON.parse(this.responseText).data;if(void 0!==a){for(var i=0,o=0;o<a.length;o++)a[o].id===t&&(i=o);var d=new videoData(a[i].attributes.youtubeId,a[i].attributes.name,a[i].attributes.description,a[i].attributes.keywords,e,a[i].attributes.thumbnail);console.log(d),d.bindToForm(),document.querySelector("#videoFormModal > div > div > div.modal-footer > button").addEventListener("click",function(){editVideo(d.id)});var n=document.createElement("button");n.type="button",n.className="btn btn-primary waves-effect waves-light",n.title="Hoàn thành form với thông tin mặc định của video",n.appendChild(document.createTextNode("Mặc định"));var r=document.createElement("i");for(r.className="fa fa-star-o ml-1",n.appendChild(r),n.addEventListener("click",function(){loadVideoOfYoutube(d.data.attributes.youtubeId,{success:function(e){void 0!==e?new videoData(e.id,e.snippet.title,e.snippet.description,e.snippet.tags,"",e.snippet.thumbnails.medium.url).bindToForm():(console.log(e),toastr.warning("Xảy ra lỗi bất thường khi load video"))}})}),document.querySelector("#videoFormModal > div > div > div.modal-footer").appendChild(n),document.querySelector("#alert-delete-video > div > div > div.modal-footer").querySelectorAll("a")[0].addEventListener("click",function(){deleteVideo(d.id)}),d.addIdCrTime(a[i].id,a[i].attributes.createdTimeMLS),loadSuggestVideo(d.data.attributes.name),d.watchVideo(),a.splice(i,1),o=0;o<a.length/6;o++){var s=document.createElement("li");s.className="nav-item";var l=document.createElement("a");l.setAttribute("data-toggle","tab"),l.setAttribute("role","tab");var c=document.createElement("div");0===o?(c.className="tab-pane fade in show active",c.id="same-pl-tab-1",l.className="nav-link orange-text waves-light active"):(c.className="tab-pane fade",c.id="same-pl-tab-"+(o+1),l.className="nav-link orange-text waves-light");var u=document.createElement("div");for(u.className="row",l.href="#"+c.id,l.innerHTML=o+1,s.appendChild(l),i=6*o;i<6*o+6&&i<a.length;i++){var p=new videoData(a[i].attributes.youtubeId,a[i].attributes.name,"","",a[i].attributes.playlistId,a[i].attributes.thumbnail);p.addIdCrTime(a[i].id,""),p.bindToTab(u,a[i].attributes.playlistId),c.appendChild(u)}document.querySelector("#same-playlist-modal > div > div > div.modal-body > div.tab-content").appendChild(c),document.querySelector("#same-playlist-modal > div > div > div.modal-body > section.tabs-wrapper > ul").appendChild(s)}}document.getElementById("content").style.display=""}else a=JSON.parse(this.responseText),console.log(a)},a.open("GET",videoApi+"?playlist="+e+"&page=1&limit=100",!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization",localStorage.getItem("token")),a.send()}function loadPlaylistDetail(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var t=JSON.parse(this.responseText).data;if(void 0!==t)for(var a=0;a<t.length;a++){var i=document.createElement("option");i.value=t[a].id,i.innerHTML=t[a].attributes.name,t[a].id===e&&(i.setAttribute("selected","true"),document.querySelector("#watching-playlist > div.view > div.playlist-thumb").style.backgroundImage="url("+t[a].attributes.thumbnailUrl+")",document.querySelector("#watching-playlist").addEventListener("dragover",function(e){allowDrop(e)}),document.querySelector("#watching-playlist").addEventListener("drop",function(t){drop(t,e)}),document.querySelector("#watching-playlist > div.card-body > h4").innerHTML=t[a].attributes.name,document.querySelector("#watching-playlist > div.card-body > p").innerHTML=t[a].attributes.description,document.querySelector("#watching-playlist > div.card-data > ul > li > span").innerHTML=new Date(t[a].attributes.createdTimeMLS).toLocaleDateString()),document.forms.uploadOrEditForm.playlistId.appendChild(i)}$(".material").materialForm()}else t=JSON.parse(this.responseText),console.log(t)},t.open("GET",playlistApi,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function uploadVideo(){var e=document.forms.uploadOrEditForm.videoId.value,t=document.forms.uploadOrEditForm.videoName.value,a=document.forms.uploadOrEditForm.description.value,i=document.forms.uploadOrEditForm.keywords.value,o=document.forms.uploadOrEditForm.playlistId.value,d="https://i.ytimg.com/vi/"+e+"/mqdefault.jpg";new videoData(e,t,a,i,o,d).uploadVideo()}function editVideo(e){var t=document.forms.uploadOrEditForm.videoId.value,a=document.forms.uploadOrEditForm.videoName.value,i=document.forms.uploadOrEditForm.description.value,o=document.forms.uploadOrEditForm.keywords.value,d=document.forms.uploadOrEditForm.playlistId.value,n="https://i.ytimg.com/vi/"+t+"/mqdefault.jpg";new videoData(t,a,i,o,d,n).editVideo(e)}function deleteVideo(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e=JSON.parse(this.responseText);toastr.error("Xóa video thành công"),$("#videoFormModal").modal("hide"),$("#alert-delete-video").modal("hide"),setTimeout(function(){location.href="../index.html"},1e3),console.log(e)}else e=JSON.parse(this.responseText),console.log(e)},t.open("DELETE",videoApi+"/"+e,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function dragVideo(e,t){e.dataTransfer.setData("text/plain",JSON.stringify(t))}function allowDrop(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}function drop(e,t){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();var a=JSON.parse(e.dataTransfer.getData("text"));a.data.attributes.playlistId=t;var i=new videoData;i.data=a.data,i.uploadVideo()}if($(document).ready(function(){$('[data-toggle="popover"]').popover(),$(".hover-popover").popover({trigger:"hover"}),$(function(){$('[data-toggle="tooltip"]').tooltip()})}),videoData.prototype.addIdCrTime=function(e,t){this.id=e,this.createdTime=t},videoData.prototype.watchVideo=function(){document.querySelector("#watching-video > div.card > div > iframe").src="https://www.youtube.com/embed/"+this.data.attributes.youtubeId+"?autoplay=1",document.querySelector("#watching-video > div.card > div.card-body > div.row > h4.col-md-9").innerHTML=this.data.attributes.name;var e=new Date(this.createdTime).toLocaleDateString();document.querySelector("#watching-video > div.card > div.card-body").querySelectorAll("p span")[0].innerHTML=e,document.querySelector("#watching-video > div.card > div.card-body").querySelectorAll("p span")[1].innerHTML=this.data.attributes.description;var t=JSON.stringify(this.data.attributes.keywords);void 0!==t&&(t=(t=t.replace("[","")).replace("]","")),document.getElementById("video-keyword").innerHTML=t},videoData.prototype.bindToSide=function(){var e=new videoData;e.data=this.data;var t=document.createElement("div");t.className="row padding-thumb animated fadeIn";var a=document.createElement("div");a.className="col-md-6";var i=document.createElement("a");i.href="#watch?yid="+this.data.attributes.youtubeId,i.setAttribute("draggable","true"),i.addEventListener("dragstart",function(t){dragVideo(t,e)});var o=document.createElement("img");o.src=this.data.attributes.thumbnail,o.alt=this.data.attributes.name,o.title=this.data.attributes.name,o.style.width="100%",i.appendChild(o),a.appendChild(i),t.appendChild(a);var d=document.createElement("div");d.className="col-md-6";var n=document.createElement("div");n.className="ellipsis";var r=document.createElement("a");r.style.marginBottom="5px",r.className="hover-popover black-text",r.href="#watch?yid="+this.data.attributes.youtubeId,r.setAttribute("data-toggle","popover"),r.setAttribute("data-placement","top"),r.setAttribute("data-content",this.data.attributes.name),r.setAttribute("data-original-title",""),r.setAttribute("title",""),r.appendChild(document.createTextNode(this.data.attributes.name)),n.appendChild(r);var s=document.createElement("p");s.className="grey-text watch-side-title";var l=new Date(this.createdTime).toLocaleDateString();s.innerHTML="<strong>Xuất bản:</strong> <span>"+l+"</span>",d.appendChild(n),d.appendChild(s),t.appendChild(d),document.getElementById("sub-video").appendChild(t)},videoData.prototype.bindToTab=function(e,t){var a=document.createElement("div");a.className="col-lg-2 col-md-4 col-sm-6",a.style.overflow="hidden",a.style.textOverflow="ellipsis";var i=document.createElement("div");i.className="card";var o=document.createElement("div");o.className="view overlay waves-effect waves-light";var d=document.createElement("img");d.className="img-fluid",d.src=this.data.attributes.thumbnail,d.alt=this.data.attributes.name,d.title=this.data.attributes.name,d.style.width="100%";var n=document.createElement("a");n.href="#watch?plid="+t+"&cid="+this.id;var r=document.createElement("div");r.className="mask flex-center",r.innerHTML='<i class="fa fa-play-circle-o fa-3x white-text"></i>',n.appendChild(r),o.appendChild(d),o.appendChild(n),i.appendChild(o),a.appendChild(i);var s=document.createElement("a");s.href="#watch?plid="+t+"&cid="+this.id,s.className="grey-text";var l=document.createElement("h6");l.style.marginTop="5px",l.appendChild(document.createTextNode(this.data.attributes.name)),s.appendChild(l),a.appendChild(s),e.appendChild(a)},videoData.prototype.bindToForm=function(){document.forms.uploadOrEditForm.videoId.value=this.data.attributes.youtubeId,document.forms.uploadOrEditForm.videoName.value=this.data.attributes.name,document.forms.uploadOrEditForm.description.value=this.data.attributes.description,document.forms.uploadOrEditForm.keywords.value=this.data.attributes.keywords,document.forms.uploadOrEditForm.playlistId.value=this.data.attributes.playlistId;for(var e=document.querySelectorAll("#uploadOrEditForm label"),t=0;t<e.length;t++)e[t].className="active"},videoData.prototype.uploadVideo=function(){this.pUploadVideo({success:function(e){toastr.success("Đã thêm video thành công!"),$("#videoFormModal").modal("hide"),console.log(e)},error:function(e){toastr.warning("Upload video thất bại. Vui lòng inspect logs hoặc báo cho chúng tôi! Xin lỗi vì sự bất tiện này!"),console.log(e)}})},videoData.prototype.editVideo=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(201===this.status){var e=JSON.parse(this.responseText);toastr.success("Chỉnh sửa video thành công! Mời xem lại tại mục quản lý playlist"),$("#videoFormModal").modal("hide"),console.log(e)}else e=JSON.parse(this.responseText),console.log(e)},t.open("PUT",videoApi+"/"+e,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send(JSON.stringify(this))},"#watch"===location.hash)$("#alertModal").modal();else{var searchObj=convertLocationSearchToJSON(location.hash);void 0===searchObj||void 0===searchObj.plid&&void 0===searchObj.yid?$("#alertModal").modal():void 0!==searchObj.yid?(loadVideoOfYoutube(searchObj.yid,{success:function(e){if(void 0!==e){var t=new videoData(e.id,e.snippet.title,e.snippet.description,e.snippet.tags,"",e.snippet.thumbnails.medium.url);t.bindToForm(),document.querySelector("#videoFormModal > div > div > div.modal-footer > button").addEventListener("click",uploadVideo),t.addIdCrTime("",e.snippet.publishedAt),t.watchVideo(),loadSuggestVideo(e.snippet.title),document.getElementById("content").style.display=""}else $("#alertModal").modal()}}),null!==userToken&&(document.querySelector("#y-video-activator").style.display="",loadPlaylistDetail(""))):void 0!==searchObj.plid&&(null!==userToken?(loadPlaylistDetail(searchObj.plid),document.querySelector("#watching-playlist").style.display="",document.querySelector("#c-video-activator").style.display="",void 0!==searchObj.cid?loadVideoOfPlaylist(searchObj.plid,searchObj.cid):loadVideoOfPlaylist(searchObj.plid,"")):$("#alertModal").modal())}